{% extends "layout.html" %}

{% block title %}授業記録詳細{% endblock %}

{% block content %}
<h1>{{ record[1] }} の記録</h1>
<p><strong>内容:</strong> {{ record[2] }}</p>
<p><strong>宿題:</strong> {{ record[3] }}</p>
<p><strong>次回予定:</strong> {{ record[4] }}</p>

<hr>
<h2>コメント</h2>
<form method="POST">
    <textarea name="comment" required></textarea>
    <input type="hidden" name="parent_id" value="">
    <button type="submit">コメントする</button>
</form>

{% macro render_comment(comment) %}
    <div style="margin-left: 20px; border-left: 1px solid #ccc; padding-left: 10px; margin-top: 10px;">
        <p><strong>{{ comment.author }}</strong>: {{ comment.comment }}</p>
        <small>{{ comment.created_at }}</small>
        {% if current_user.role == 'teacher' %}
        <form method="POST" style="margin-top: 5px;">
            <input type="hidden" name="parent_id" value="{{ comment.id }}">
            <textarea name="comment" placeholder="返信..." required></textarea>
            <button type="submit">返信</button>
        </form>
        {% endif %}
        {% for child in comment.children %}
            {{ render_comment(child) }}
        {% endfor %}
    </div>
{% endmacro %}

{% for comment in comments %}
    {{ render_comment(comment) }}
{% endfor %}
{% endblock %}

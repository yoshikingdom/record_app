{% extends "layout.html" %}

{% block title %}æˆæ¥­è¨˜éŒ²è©³ç´°{% endblock %}

{% block content %}
<h1 class="mb-4">ğŸ“˜ æˆæ¥­è¨˜éŒ²ã®è©³ç´°</h1>

<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <h5 class="card-title">{{ record[2] }}</h5>
    <p class="card-text"><strong>ğŸ“… æ—¥ä»˜:</strong> {{ record[1] }}</p>
    <p class="card-text"><strong>ğŸ“– æˆæ¥­å†…å®¹:</strong><br>{{ record[3] }}</p>
    <p class="card-text"><strong>ğŸ“š å®¿é¡Œ:</strong><br>{{ record[4] }}</p>
    <p class="card-text"><strong>ğŸ¯ æ¬¡å›äºˆå®š:</strong><br>{{ record[5] }}</p>
  </div>
</div>

<hr>
<h2 class="mt-4">ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆ</h2>

<form method="POST" class="mb-4">
  <div class="mb-3">
    <label class="form-label">ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ </label>
    <textarea name="comment" class="form-control" required></textarea>
    <input type="hidden" name="parent_id" value="">
  </div>
  <button type="submit" class="btn btn-primary">æŠ•ç¨¿</button>
</form>

{% macro render_comment(comment, level=0) %}
<div class="card mb-2 ms-{{ level * 2 }} shadow-sm">
  <div class="card-body">
    {% if comment.comment == '[å‰Šé™¤æ¸ˆã¿]' %}
      <p class="text-muted fst-italic">[å‰Šé™¤æ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆ]</p>
    {% else %}
      <p><strong>{{ comment.author }}</strong>: {{ comment.comment }}</p>
    {% endif %}
    <small class="text-muted">{{ comment.created_at }}</small>

    {% if comment.comment != '[å‰Šé™¤æ¸ˆã¿]' and (current_user.role == 'teacher' or current_user.username == comment.author) %}
    <form method="POST" action="{{ url_for('delete_comment', comment_id=comment.id) }}" class="d-inline-block mt-2">
      <button type="submit" class="btn btn-sm btn-outline-danger">ğŸ—‘ï¸ å‰Šé™¤</button>
    </form>
    {% endif %}

    {% if comment.comment != '[å‰Šé™¤æ¸ˆã¿]' %}
    <form method="POST" class="mt-2">
      <input type="hidden" name="parent_id" value="{{ comment.id }}">
      <textarea name="comment" class="form-control mb-2" placeholder="è¿”ä¿¡..." required></textarea>
      <button type="submit" class="btn btn-sm btn-secondary">è¿”ä¿¡</button>
    </form>
    {% endif %}

    {% for child in comment.children %}
      {{ render_comment(child, level + 1) }}
    {% endfor %}
  </div>
</div>
{% endmacro %}

{% for comment in comments %}
  {{ render_comment(comment) }}
{% endfor %}
{% endblock %}
